(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{468:function(s,a,t){"use strict";t.r(a);var n=t(6),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("PM2 是 node 进程管理工具，可以利用它来简化很多 node 应用管理的繁琐任务，如性能监控、自动重启、负载均衡等，而且使用非常简单。\n下面就对 PM2 进行入门性的介绍，基本涵盖了 PM2 的常用的功能和配置")]),s._v(" "),a("h2",{attrs:{id:"安装-pm2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-pm2"}},[s._v("#")]),s._v(" 安装 PM2")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("$ npm install pm2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("g\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"启动一个应用程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动一个应用程序"}},[s._v("#")]),s._v(" 启动一个应用程序")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("$ pm2 start app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"更新-pm2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新-pm2"}},[s._v("#")]),s._v(" 更新 PM2")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装最新的pm2")]),s._v("\n$ pm2 save "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 记得保存进程状态")]),s._v("\n$ npm install pm2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("g\n$ pm2 update\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"目录介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目录介绍"}},[s._v("#")]),s._v(" 目录介绍")]),s._v(" "),a("p",[s._v("pm2 安装好后，会自动创建下面目录。看文件名基本就知道干嘛的了，就不翻译了。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("$HOME/.pm2")]),s._v(" will contain all PM2 related files")]),s._v(" "),a("li",[a("code",[s._v("$HOME/.pm2/logs")]),s._v(" will contain all applications logs")]),s._v(" "),a("li",[a("code",[s._v("$HOME/.pm2/pids")]),s._v(" will contain all applications pids")]),s._v(" "),a("li",[a("code",[s._v("$HOME/.pm2/pm2.log")]),s._v(" PM2 logs")]),s._v(" "),a("li",[a("code",[s._v("$HOME/.pm2/pm2.pid")]),s._v(" PM2 pid")]),s._v(" "),a("li",[a("code",[s._v("$HOME/.pm2/rpc.sock")]),s._v(" Socket file for remote commands")]),s._v(" "),a("li",[a("code",[s._v("$HOME/.pm2/pub.sock")]),s._v(" Socket file for publishable events")]),s._v(" "),a("li",[a("code",[s._v("$HOME/.pm2/conf.js")]),s._v(" PM2 Configuration")])]),s._v(" "),a("h2",{attrs:{id:"入门教程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#入门教程"}},[s._v("#")]),s._v(" 入门教程")]),s._v(" "),a("p",[s._v("一般我们都是通过"),a("code",[s._v("npm start")]),s._v("启动应用，其实就是调用"),a("code",[s._v("node ./bin/www")]),s._v("。那么，换成 pm2 就是")]),s._v(" "),a("p",[s._v("注意，这里用了"),a("code",[s._v("--watch")]),s._v("参数，意味着当你的 express 应用代码发生变化时，pm2 会帮你重启服务，多贴心。")]),s._v(" "),a("div",{staticClass:"language-undefined line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pm2 start ./bin/www --watch\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("官方文档："),a("code",[s._v("http://pm2.keymetrics.io/docs/usage/quick-start](https://links.jianshu.com/go?to=http%3A%2F%2Fpm2.keymetrics.io%2Fdocs%2Fusage%2Fquick-start")])]),s._v(" "),a("h2",{attrs:{id:"常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),a("h3",{attrs:{id:"启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),a("p",[s._v("参数说明：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("--watch")]),s._v("：监听应用目录的变化，一旦发生变化，自动重启。如果要精确监听、不见听的目录，最好通过配置文件。")]),s._v(" "),a("li",[a("code",[s._v("-i --instances")]),s._v("：启用多少个实例，可用于负载均衡。如果"),a("code",[s._v("-i 0")]),s._v("或者"),a("code",[s._v("-i max")]),s._v("，则根据当前机器核数确定实例数目。")]),s._v(" "),a("li",[a("code",[s._v("--ignore-watch")]),s._v("：排除监听的目录/文件，可以是特定的文件名，也可以是正则。比如"),a("code",[s._v('--ignore-watch="test node_modules "some scripts""')])]),s._v(" "),a("li",[a("code",[s._v("-n --name")]),s._v("：应用的名称。查看应用信息的时候可以用到。")]),s._v(" "),a("li",[a("code",[s._v("-o --output <path>")]),s._v("：标准输出日志文件的路径。")]),s._v(" "),a("li",[a("code",[s._v("-e --error <path>")]),s._v("：错误输出日志文件的路径。")]),s._v(" "),a("li",[a("code",[s._v("--interpreter <interpreter>")]),s._v("：the interpreter pm2 should use for executing app (bash, python...)。比如你用的 coffee script 来编写应用。")])]),s._v(" "),a("p",[s._v("完整命令行参数列表："),a("a",{attrs:{href:"https://links.jianshu.com/go?to=http%3A%2F%2Fpm2.keymetrics.io%2Fdocs%2Fusage%2Fquick-start%2F%23options",target:"_blank",rel:"noopener noreferrer"}},[s._v("地址"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-css line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-css"}},[a("code",[s._v("pm2 start app.js --watch -i 2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"重启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重启"}},[s._v("#")]),s._v(" 重启")]),s._v(" "),a("div",{staticClass:"language-css line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-css"}},[a("code",[s._v("pm2 restart app.js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"停止"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#停止"}},[s._v("#")]),s._v(" 停止")]),s._v(" "),a("p",[s._v("停止特定的应用。可以先通过"),a("code",[s._v("pm2 list")]),s._v("获取应用的名字（--name 指定的）或者进程 id。")]),s._v(" "),a("div",{staticClass:"language-undefined line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pm2 stop app_name|app_id\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果要停止所有应用，可以")]),s._v(" "),a("div",{staticClass:"language-undefined line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pm2 stop all\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"删除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除"}},[s._v("#")]),s._v(" 删除")]),s._v(" "),a("p",[s._v("类似"),a("code",[s._v("pm2 stop")]),s._v("，如下")]),s._v(" "),a("div",{staticClass:"language-undefined line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pm2 stop app_name|app_id\npm2 stop all\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"查看进程状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看进程状态"}},[s._v("#")]),s._v(" 查看进程状态")]),s._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[s._v("pm2 list\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"查看某个进程的信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看某个进程的信息"}},[s._v("#")]),s._v(" 查看某个进程的信息")]),s._v(" "),a("div",{staticClass:"language-kotlin line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-kotlin"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token label symbol"}},[s._v("root@")]),s._v("iZ94wb7tioqZ pids"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# pm2 describe "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nDescribing process with id "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name oc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server\n┌───────────────────┬──────────────────────────────────────────────────────────────┐\n│ status            │ online                                                       │\n│ name              │ oc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server                                                    │\n│ id                │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                                                            │\n│ path              │ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("qiquan"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("over_the_counter"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www            │\n│ args              │                                                              │\n│ exec cwd          │ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("qiquan"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("over_the_counter"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server                    │\n│ error log path    │ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("qiquan"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("over_the_counter"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("err"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log │\n│ "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("out")]),s._v(" log path      │ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("qiquan"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("over_the_counter"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("out")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log │\n│ pid path          │ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pm2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pids"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pid                              │\n│ mode              │ fork_mode                                                    │\n│ node v8 arguments │                                                              │\n│ watch & reload    │                                                              │\n│ interpreter       │ node                                                         │\n│ restarts          │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("293")]),s._v("                                                          │\n│ unstable restarts │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                                                            │\n│ uptime            │ 87m                                                          │\n│ created at        │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2016")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("26T08"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("705Z                                     │\n└───────────────────┴──────────────────────────────────────────────────────────────┘\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h2",{attrs:{id:"配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[s._v("#")]),s._v(" 配置文件")]),s._v(" "),a("h3",{attrs:{id:"简单说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单说明"}},[s._v("#")]),s._v(" 简单说明")]),s._v(" "),a("ul",[a("li",[s._v("配置文件里的设置项，跟命令行参数基本是一一对应的。")]),s._v(" "),a("li",[s._v("可以选择"),a("code",[s._v("yaml")]),s._v("或者"),a("code",[s._v("json")]),s._v("文件，就看个人洗好了。")]),s._v(" "),a("li",[a("code",[s._v("json")]),s._v("格式的配置文件，pm2 当作普通的 js 文件来处理，所以可以在里面添加注释或者编写代码，这对于动态调整配置很有好处。")]),s._v(" "),a("li",[s._v("如果启动的时候指定了配置文件，那么命令行参数会被忽略。（个别参数除外，比如--env）")])]),s._v(" "),a("h3",{attrs:{id:"例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[s._v("#")]),s._v(" 例子")]),s._v(" "),a("p",[s._v("举个简单例子，完整配置说明请参考"),a("a",{attrs:{href:"https://links.jianshu.com/go?to=http%3A%2F%2Fpm2.keymetrics.io%2Fdocs%2Fusage%2Fpm2-doc-single-page%2F",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fis-receiver"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 应用名称")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"script"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./bin/www"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 实际启动脚本")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"cwd"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 当前工作路径")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"watch"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 监控变化的目录，一旦变化，自动重启")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"routers"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"ignore_watch"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 从监控目录中排除")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node_modules"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"public"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"watch_options"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"followSymlinks"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"error_file"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./logs/app-err.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 错误日志路径")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"out_file"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./logs/app-out.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 普通日志路径")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"env"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"NODE_ENV"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"production"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 环境参数，当前指定为生产环境")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("h2",{attrs:{id:"自动重启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动重启"}},[s._v("#")]),s._v(" 自动重启")]),s._v(" "),a("p",[s._v("前面已经提到了，这里贴命令行，更多点击"),a("a",{attrs:{href:"https://links.jianshu.com/go?to=http%3A%2F%2Fpm2.keymetrics.io%2Fdocs%2Fusage%2Fwatch-and-restart%2F%23auto-restart-apps-on-file-change",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("div",{staticClass:"language-css line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-css"}},[a("code",[s._v("pm2 start app.js --watch\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这里是监控整个项目的文件，如果只想监听指定文件和目录，建议通过配置文件的"),a("code",[s._v("watch")]),s._v("、"),a("code",[s._v("ignore_watch")]),s._v("字段来设置。")]),s._v(" "),a("h2",{attrs:{id:"环境切换"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境切换"}},[s._v("#")]),s._v(" 环境切换")]),s._v(" "),a("p",[s._v("在实际项目开发中，我们的应用经常需要在多个环境下部署，比如开发环境、测试环境、生产环境等。在不同环境下，有时候配置项会有差异，比如链接的数据库地址不同等。")]),s._v(" "),a("p",[s._v("对于这种场景，pm2 也是可以很好支持的。首先通过在配置文件中通过"),a("code",[s._v("env_xx")]),s._v("来声明不同环境的配置，然后在启动应用时，通过"),a("code",[s._v("--env")]),s._v("参数指定运行的环境。")]),s._v(" "),a("h3",{attrs:{id:"环境配置声明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境配置声明"}},[s._v("#")]),s._v(" 环境配置声明")]),s._v(" "),a("p",[s._v("首先，在配置文件中，通过"),a("code",[s._v("env")]),s._v("选项声明多个环境配置。简单说明下：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("env")]),s._v("为默认的环境配置（生产环境），"),a("code",[s._v("env_dev")]),s._v("、"),a("code",[s._v("env_test")]),s._v("则分别是开发、测试环境。可以看到，不同环境下的"),a("code",[s._v("NODE_ENV")]),s._v("、"),a("code",[s._v("REMOTE_ADDR")]),s._v("字段的值是不同的。")]),s._v(" "),a("li",[s._v("在应用中，可以通过"),a("code",[s._v("process.env.REMOTE_ADDR")]),s._v("等来读取配置中生命的变量。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"env"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NODE_ENV"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"production"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"REMOTE_ADDR"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://www.example.com/"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"env_dev"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NODE_ENV"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"development"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"REMOTE_ADDR"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://wdev.example.com/"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"env_test"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NODE_ENV"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"REMOTE_ADDR"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://wtest.example.com/"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"启动指明环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动指明环境"}},[s._v("#")]),s._v(" 启动指明环境")]),s._v(" "),a("p",[s._v("假设通过下面启动脚本（开发环境），那么，此时"),a("code",[s._v("process.env.REMOTE_ADDR")]),s._v("的值就是相应的 "),a("a",{attrs:{href:"https://links.jianshu.com/go?to=http%3A%2F%2Fwdev.example.com%2F",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://wdev.example.com/"),a("OutboundLink")],1),s._v(" ，可以自己试验下。")]),s._v(" "),a("div",{staticClass:"language-css line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-css"}},[a("code",[s._v("pm2 start app.js --env dev\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡"}},[s._v("#")]),s._v(" 负载均衡")]),s._v(" "),a("p",[s._v("命令如下，表示开启三个进程。如果"),a("code",[s._v("-i 0")]),s._v("，则会根据机器当前核数自动开启尽可能多的进程。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("pm2 start app.js "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启三个进程")]),s._v("\npm2 start app.js "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" max "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据机器CPU核数，开启对应数目的进程")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("参考文档："),a("a",{attrs:{href:"https://links.jianshu.com/go?to=http%3A%2F%2Fpm2.keymetrics.io%2Fdocs%2Fusage%2Fcluster-mode%2F%23automatic-load-balancing",target:"_blank",rel:"noopener noreferrer"}},[s._v("点击查看"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"日志查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志查看"}},[s._v("#")]),s._v(" 日志查看")]),s._v(" "),a("p",[s._v("除了可以打开日志文件查看日志外，还可以通过"),a("code",[s._v("pm2 logs")]),s._v("来查看实时日志。这点对于线上问题排查非常重要。")]),s._v(" "),a("p",[s._v("比如某个 node 服务突然异常重启了，那么可以通过 pm2 提供的日志工具来查看实时日志，看是不是脚本出错之类导致的异常重启。")]),s._v(" "),a("div",{staticClass:"language-undefined line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pm2 logs\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"指令-tab-补全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指令-tab-补全"}},[s._v("#")]),s._v(" 指令 tab 补全")]),s._v(" "),a("p",[s._v("运行"),a("code",[s._v("pm2 --help")]),s._v("，可以看到"),a("code",[s._v("pm2")]),s._v("支持的子命令还是蛮多的，这个时候，自动完成的功能就很重要了。")]),s._v(" "),a("p",[s._v("运行如下命令。恭喜，已经能够通过 tab 自动补全了。细节可参考"),a("a",{attrs:{href:"https://links.jianshu.com/go?to=http%3A%2F%2Fpm2.keymetrics.io%2Fdocs%2Fusage%2Fauto-completion%2F",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("pm2 completion "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" ~/.bash_profile\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"开机自动启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开机自动启动"}},[s._v("#")]),s._v(" 开机自动启动")]),s._v(" "),a("p",[s._v("可以通过"),a("code",[s._v("pm2 startup")]),s._v("来实现开机自启动。细节可"),a("a",{attrs:{href:"https://links.jianshu.com/go?to=http%3A%2F%2Fpm2.keymetrics.io%2Fdocs%2Fusage%2Fstartup%2F",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考"),a("OutboundLink")],1),s._v("。大致流程如下")]),s._v(" "),a("ol",[a("li",[s._v("通过"),a("code",[s._v("pm2 save")]),s._v("保存当前进程状态。")]),s._v(" "),a("li",[s._v("通过"),a("code",[s._v("pm2 startup [platform]")]),s._v("生成开机自启动的命令。（记得查看控制台输出）")]),s._v(" "),a("li",[s._v("将步骤 2 生成的命令，粘贴到控制台进行，搞定。")])]),s._v(" "),a("h2",{attrs:{id:"传入-node-args"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#传入-node-args"}},[s._v("#")]),s._v(" 传入 node args")]),s._v(" "),a("p",[s._v("直接上例子，分别是通过命令行和配置文件。")]),s._v(" "),a("p",[s._v("命令行：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("pm2 start app.js --node-args"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--harmony"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("配置文件：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"oc-server"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"script"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"node_args"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--harmony"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"实例说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实例说明"}},[s._v("#")]),s._v(" 实例说明")]),s._v(" "),a("p",[s._v("假设是在"),a("code",[s._v("centos")]),s._v("下，那么运行如下命令，搞定。强烈建议运行完成之后，重启机器，看是否设置成功。")]),s._v(" "),a("div",{staticClass:"language-csharp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("@iZ94wb7tioqZ")]),s._v(" option_analysis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# pm2 save\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("@iZ94wb7tioqZ")]),s._v(" option_analysis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# pm2 startup centos\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("PM2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Generating system "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("init")]),s._v(" script "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pm2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("PM2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Making script booting at startup"),a("span",{pre:!0,attrs:{class:"token range operator"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PM2")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("lock")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("subsys"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pm2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh lockfile has been added\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("PM2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("centos"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" Using "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("the")]),s._v(" command"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      su "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"chmod +x /etc/init.d/pm2-init.sh; chkconfig --add pm2-init.sh"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PM2")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("@iZ94wb7tioqZ")]),s._v(" option_analysis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# pm2 save\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("PM2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Dumping processes\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h2",{attrs:{id:"监控-monitor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#监控-monitor"}},[s._v("#")]),s._v(" 监控(monitor)")]),s._v(" "),a("p",[s._v("运行如下命令，查看当前通过 pm2 运行的进程的状态。")]),s._v(" "),a("div",{staticClass:"language-undefined line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pm2 monit\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("看到类似输出")]),s._v(" "),a("div",{staticClass:"language-kotlin line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-kotlin"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token label symbol"}},[s._v("root@")]),s._v("oneday"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dev0 server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# pm2 monit\n⌬ PM2 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("monitoring")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("To go further check "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("out")]),s._v(" https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("keymetrics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("                              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("\n⌬ PM2 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("monitoring")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("To go further check o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("|               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("196.285")]),s._v(" MB\n\n ● fis"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("receiver                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("                              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("fork_mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("|                         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65.773")]),s._v(" MB\n\n ● www                                 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("                              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("fork_mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("|                         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("74.426")]),s._v(" MB\n\n ● oc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server                           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("                              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("fork_mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("                          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("57.801")]),s._v(" MB\n\n ● pm2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v("                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("                              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" stopped\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("fork_mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("                              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B\n\n ● start"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("production\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("fork_mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h2",{attrs:{id:"内存使用超过上限自动重启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内存使用超过上限自动重启"}},[s._v("#")]),s._v(" 内存使用超过上限自动重启")]),s._v(" "),a("p",[s._v("如果想要你的应用，在超过使用内存上限后自动重启，那么可以加上"),a("code",[s._v("--max-memory-restart")]),s._v("参数。（有对应的配置项）")]),s._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[s._v("pm2 start big"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("max"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("memory"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("restart "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("M\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"常用命令一览"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令一览"}},[s._v("#")]),s._v(" 常用命令一览")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 普通 General")]),s._v("\n$ npm install pm2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("g            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 PM2")]),s._v("\n$ pm2 start app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动，守护进程，自动重启应用程序 Start, Daemonize and auto-restart application (Node)")]),s._v("\n$ pm2 start app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("py              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动，守护进程，自动重启python应用程序 Start, Daemonize and auto-restart application (Python)")]),s._v("\n$ pm2 start npm "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" start        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动，守护进程，自动重启node应用程序 Start, Daemonize and auto-restart Node application")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群模式 (只支持node进程) Cluster Mode (Node.js only)")]),s._v("\n$ pm2 start app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在集群模式下，启动4个应用程序实例  Start 4 instances of application in cluster mode")]),s._v("\n                                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同时，将网络请求，负载均衡到每个应用实例  it will load balance network queries to each app")]),s._v("\n$ pm2 reload all                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 0秒重启所有应用 Zero Second Downtime Reload")]),s._v("\n$ pm2 scale "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将应用进程调整到10 Scale Cluster app to 10 process")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程监控 Scale Cluster app to 10 process")]),s._v("\n$ pm2 list                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出所有用PM2启动的进程 List all processes started with PM2")]),s._v("\n$ pm2 monit                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示每个应用占用的cpu和内存 Display memory and cpu usage of each app")]),s._v("\n$ pm2 show "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示某个进程的所有信息 Show all informations about application")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志管理 Log management")]),s._v("\n$ pm2 logs                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示所有应用的日志  Display logs of all apps")]),s._v("\n$ pm2 logs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示某个应用的日志 Display logs for a specific app")]),s._v("\n$ pm2 logs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("json               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# json化日志 Logs in JSON format")]),s._v("\n$ pm2 flush\n$ pm2 reloadLogs\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程状态管理 Process State Management")]),s._v("\n$ pm2 start app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"api"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 启动一个应用并命名为api。 Start application and name it "api"')]),s._v("\n$ pm2 start app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 启动一个应用，并传递“-a 34”的参数。 Start app and pass option "-a 34" as argument')]),s._v("\n$ pm2 start app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("watch      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启一个应用，当文件改变的时候。Restart application on file change")]),s._v("\n$ pm2 start script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动一个bash脚本。Start bash script")]),s._v("\n$ pm2 start app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动在app.json中声明的所有应用。Start all applications declared in app.json")]),s._v("\n$ pm2 reset "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重置所有计数器。Reset all counters")]),s._v("\n$ pm2 stop all                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止所有应用。Stop all apps")]),s._v("\n$ pm2 stop "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止id 为0的应用。Stop process with id 0")]),s._v("\n$ pm2 restart all               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启所有应用。Restart all apps")]),s._v("\n$ pm2 gracefulReload all        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在集群模式下，平稳的重加载所有应用。Graceful reload all apps in cluster mode")]),s._v("\n$ pm2 delete all                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 杀掉所有应用。Kill and delete all apps")]),s._v("\n$ pm2 delete "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 杀掉id为0的进程。Delete app with id 0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动／引导管理 Startup/Boot management")]),s._v("\n$ pm2 startup                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检测init系统，在启动时生成和配置pm2。Detect init system, generate and configure pm2 boot on startup")]),s._v("\n$ pm2 save                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存当前进程列表。Save current process list")]),s._v("\n$ pm2 resurrect                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 恢复以前保存的进程。Restore previously save processes")]),s._v("\n$ pm2 unstartup                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停用和删除启动系统。Disable and remove startup system")]),s._v("\n$ pm2 update                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存进程，终止PM2并恢复进程。Save processes, kill PM2 and restore processes")]),s._v("\n$ pm2 generate                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成样本json配置文件。Generate a sample json configuration file")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部署 Deployment")]),s._v("\n$ pm2 deploy app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json prod setup    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 设置“生产环境”远程服务器。 Setup "prod" remote server')]),s._v("\n$ pm2 deploy app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json prod          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 更新“生产环境”远程服务器。 Update "prod" remote server')]),s._v("\n$ pm2 deploy app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json prod revert "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 将“生产环境”远程服务器恢复2。Revert "prod" remote server by 2')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 模块系统 Module system")]),s._v("\n$ pm2 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("module")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":generate")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成名称为[name]的示例模块。Generate sample module with name [name]")]),s._v("\n$ pm2 install pm2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("logrotate     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装模块（这里是日志循环系统）。Install module (here a log rotation system)")]),s._v("\n$ pm2 uninstall pm2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("logrotate   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 卸载模块。Uninstall module")]),s._v("\n$ pm2 publish                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增量版本，git push和npm发布。Increment version, git push and npm publish")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br")])]),a("h3",{attrs:{id:"进程管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进程管理"}},[s._v("#")]),s._v(" 进程管理")]),s._v(" "),a("p",[s._v("列出正在运行的应用程序")]),s._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[s._v("$ pm2 list\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("很简单的管理你的应用进程")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("$ pm2 stop     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("app_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'all'")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("json_conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n$ pm2 restart  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("app_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'all'")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("json_conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n$ pm2 delete   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("app_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'all'")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("json_conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"cpu-进程监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cpu-进程监控"}},[s._v("#")]),s._v(" CPU/进程监控")]),s._v(" "),a("p",[s._v("监控所有启动的进程：")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("$ pm2 monit\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"日志设施"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志设施"}},[s._v("#")]),s._v(" 日志设施")]),s._v(" "),a("p",[s._v("实时显示指定进程或所有进程的日志。提供标准，原始，JSON 和格式输出。")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("$ pm2 logs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'all'")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("app_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("app_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("raw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("`\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("例子:")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("$ pm2 logs "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("APP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Display APP-NAME logs")]),s._v("\n$ pm2 logs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("json         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# JSON output")]),s._v("\n$ pm2 logs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("format       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Formated output")]),s._v("\n\n$ pm2 flush               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Flush all logs")]),s._v("\n$ pm2 reloadLogs          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Reload all logs")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"生成启动脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成启动脚本"}},[s._v("#")]),s._v(" 生成启动脚本")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* PM2可以生成和配置启动脚本，以在每次服务器重新启动时保持PM2和您的进程活动。\n支持init系统，如：systemd（Ubuntu 16，CentOS，Arch），upstart（Ubuntu 14/12），launchd（MacOSx，Darwin），rc.d（FreeBSD）。\n自动检测init系统+在服务器启动时生成和设置PM2引导。 Auto detect init system + generate and setup PM2 boot at server startup */")]),s._v("\n$ pm2 startup\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 手动指定启动系统. Manually specify the startup system")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以是：systemd，upstart，launchd，rcd。")]),s._v("\n$ pm2 startup "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("platform"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在服务器启动时禁用和删除PM2引导。Disable and remove PM2 boot at server startup")]),s._v("\n$ pm2 unstartup\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("在重新启动时保存/冻结进程列表：")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("$ pm2 save\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"模块系统-module-system"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块系统-module-system"}},[s._v("#")]),s._v(" 模块系统 Module system")]),s._v(" "),a("p",[s._v("PM2 嵌入了一个简单而强大的模块系统。安装模块很简单：")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("$ pm2 install "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("module_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);